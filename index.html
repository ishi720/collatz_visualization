
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Collatz Visualization</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <script type="text/javascript" src="./node_modules/visjs-network/dist/vis.js"></script>
    <link href="./node_modules/visjs-network/dist/vis.css" rel="stylesheet">

    <style type="text/css">
      #network {
        width:  100%;
        height: 500px;
        border: 1px solid #000;
      }
    </style>
</head>
<body>
    <h2>Collatz Visualization</h2>
    <input id="input_number" type="number" min="2" value="2">
    <button onclick="nodeAddButton()">追加</button>

    <div>
      <button onclick="nodeRemove()">選択を削除</button>
    </div>

    <div>
      <button onclick="nodeClear()">すべてクリア</button>
    </div>

    <div>
      <button onclick="collatzRepeatButton()">選択した数から1までを追加する</button>
    </div>


    <div id="network"></div>
</body>
</html>

<script type="text/javascript">
var nodes = new vis.DataSet([
  {id: 1, label: '1'}
]);
var edges = new vis.DataSet();
var container = document.getElementById('network');
var data = {
  nodes: nodes,
  edges: edges
}
var options = {};
var network = new vis.Network(container, data, options);

//ダブルクリックイベント
network.on("doubleClick", function(params) {
  if (params.nodes.length == 1) {
    //クリック時に前後の数を追加する
    var nodeId = params.nodes[0];
    nodeAdd(collatz(nodeId));
    collatzReverseOrder(nodeId).forEach(function(n) {
      nodeAdd(n);
    });
  }
});

/*
 * コラッツ問題の計算を行う
 * @param  {Number} n 自然数
 * @return {Number}   計算結果
 */
function collatz(n) {

  if (n === 1)  {
    return;
  }
  if (n % 2 === 0) {
    return n / 2;
  } else {
    return (n * 3) + 1;
  }
}

/*
 * コラッツ問題の計算を逆から行う
 * @param  {Number} n 自然数
 * @return {Array}   計算結果
 */
function collatzReverseOrder(n) {
  var array = [];
  if (n !== 1) {
    if (((n - 1) / 3) % 2 === 1) {
      if ((n - 1) / 3 !== 1) {
        array.push((n - 1) / 3);
      }
    }
  }
  array.push(n * 2);
  return array;
}

/*
 * 1になるまで追加
 * @param  {Number} n 自然数
 */
function collatzRepeat(n) {
  nodeAdd(n);
  nodeAdd(collatzReverseOrder(n));
  while ( n !== 1 ) {
    n = collatz(n);
    nodeAdd(n);

    collatzReverseOrder(n).forEach(function(n) {
      nodeAdd(n);
    });
  }
}

/*
 * 選択したnodeから1になるまで追加するボタン
 */
function collatzRepeatButton() {
  if ( network.getSelectedNodes().length > 0 ) {
    var n = network.getSelectedNodes();
    collatzRepeat(n);
  }
}

/*
 * すべてのnodeをクリア
 */
function nodeClear() {
  nodes.clear();
  edges.clear();
}

/*
 * nodeを追加する
 * @param  {Number} n 自然数
 */
function nodeAdd(n) {

  if (nodes.get(n)) {
    return; //登録済みのnodeは追加しない
  }

  nodes.add([{
    id: n,
    label: String(n)
  }]);

  if (n !== 1) {
    edges.add([{
      id: n,
      from: String(n),
      to: String(collatz(n)),
      arrows: 'to'
    }]);
  }
}

/*
 * 選択したnodeを削除する
 */
function nodeRemove() {
  var selectedNode = network.getSelectedNodes();
  nodes.remove(selectedNode);
  edges.remove(selectedNode);
}

/*
 * inputタグの情報からnodeを追加する
 */
function nodeAddButton() {
  n = Number(document.getElementById("input_number").value);
  nodeAdd(n);
}

</script>
