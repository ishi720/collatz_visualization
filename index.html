
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Collatz Visualization</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <script type="text/javascript" src="./node_modules/visjs-network/dist/vis.js"></script>
    <link href="./node_modules/visjs-network/dist/vis.css" rel="stylesheet">

    <style type="text/css">
      #network {
        width:  100%;
        height: 500px;
        border: 1px solid #000;
      }
    </style>
</head>
<body>
    <h2>Collatz Visualization</h2>
    <input id="input_number" type="number" min="2" value="2">
    <button onclick="nodeAddButton()">追加</button>
    <div id="network"></div>
</body>
</html>

<script type="text/javascript">
var nodes = new vis.DataSet([
  {id: 1, label: '1'}
]);
var edges = new vis.DataSet();
var container = document.getElementById('network');
var data = {
  nodes: nodes,
  edges: edges
}
var options = {};
var network = new vis.Network(container, data, options);

//ダブルクリックイベント
network.on("doubleClick", function(params) {
  if (params.nodes.length == 1) {
    //クリック時に前後の数を追加する
    var nodeId = params.nodes[0];
    nodeAdd(collatz(nodeId));
    collatzReverseOrder(nodeId).forEach(function(n) {
      nodeAdd(n);
    });
  }
});

/*
 * コラッツ問題の計算を行う
 * @param  {Number} n 自然数
 * @return {Number}   計算結果
 */
function collatz(n) {
  if (n % 2 === 0) {
    return n / 2;
  } else {
    return (n * 3) + 1;
  }
}

/*
 * コラッツ問題の計算を逆から行う
 * @param  {Number} n 自然数
 * @return {Array}   計算結果
 */
function collatzReverseOrder(n) {
  var array = [];
  if (n !== 1) {
    if (((n - 1) / 3) % 2 === 1) {
      array.push((n - 1) / 3);
    }
  }
  array.push(n * 2);
  return array;
}

/*
 * nodeを追加する
 * @param  {Number} n 自然数
 */
function nodeAdd(n) {

  if (nodes.get(n)) {
    return; //登録済みのnodeは追加しない
  }

  nodes.add([{
    id: n,
    label: String(n)
  }]);

  edges.add([{
    from: String(n),
    to: String(collatz(n)),
    arrows: 'to'
  }]);
}

/*
 * inputタグの情報からnodeを追加する
 */
function nodeAddButton() {
  n = Number(document.getElementById("input_number").value);
  nodeAdd(n);
}

</script>
